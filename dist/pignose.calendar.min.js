//================================================================================
// [pg-calendar]
// version: 1.4.4
// update: 2017.03.02
//================================================================================

var ComponentName="pignoseCalendar",ComponentVersion="1.4.4";window[ComponentName]={VERSION:"1.4.4"};var DateManager=function(){var a={},b=function(a){this.year=parseInt(a.format("YYYY"),10),this.month=parseInt(a.format("MM"),10),this.prevMonth=parseInt(a.clone().add(-1,"months").format("MM"),10),this.nextMonth=parseInt(a.clone().add(1,"months").format("MM"),10),this.day=parseInt(a.format("DD"),10),this.firstDay=1,this.lastDay=parseInt(a.clone().endOf("month").format("DD"),10),this.weekDay=a.weekday(),this.date=a};return b.prototype.toString=function(){return this.date.format("YYYY-MM-DD")},b.Convert=function(b,c,d){var e=Helper.Format("{0}-{1}-{2}",b,c,d);return void 0===a[e]&&(a[e]=moment(e,"YYYY-MM-DD")),a[e]},b}(),Helper=function(){var a={},b={},c={},d=/[A-Z]/,e=function(){};return e.Format=function(b){if(void 0===b||""===b||arguments.length<=1)return"";var c=Array.prototype.slice.call(arguments,1),d=b+c.join("");if(void 0!==a[d])return a[d];for(var e=c.length,f=0;f<e;f++){var g=c[f];b=b.replace(new RegExp("((?!\\\\)?\\{"+f+"(?!\\\\)?\\})","g"),g)}return b=b.replace(new RegExp("\\\\{([0-9]+)\\\\}","g"),"{$1}"),a[d]=b,b},e.GetClass=function(a){var c=ComponentName+a;if(void 0!==b[c])return b[c];for(var e,f=a.split(""),g=[],h=f.length,i=0,j=0;i<h;i++){var k=f[i];"string"==typeof k&&(d.test(k)===!0&&(g[j++]="-",k=k.toString().toLowerCase()),g[j++]=k)}return e=g.join(""),b[c]=e,e},e.GetSubClass=function(a){return void 0===c[a]&&(c[a]=e.GetClass(e.Format("{0}{1}",ComponentName,a))),c[a]},e}();void 0===Array.prototype.filter&&(Array.prototype.filter=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)return[];for(var d=[],e=arguments[1],f=0;f<c;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d});var ComponentClass=Helper.GetClass(ComponentName),ComponentPreference={supports:{themes:["light","dark","blue"]}};!function(a){"use strict";var b=a(window),c=(a(document),Helper.GetSubClass("Top")),d=Helper.GetSubClass("Header"),e=Helper.GetSubClass("Body"),f=Helper.GetSubClass("Button"),g={supports:["en","ko","fr","ch","de","jp","pt","da","pl","es"],weeks:{en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ko:["일","월","화","수","목","금","토"],fr:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],ch:["日","一","二","三","四","五","六"],de:["SO","MO","DI","MI","DO","FR","SA"],jp:["日","月","火","水","木","金","土"],pt:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],da:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],pl:["Nie","Pon","Wto","Śro","Czw","Pią","Sob"],es:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"]},monthsLong:{en:["January","February","March","April","May","Jun","July","August","September","October","November","December"],ko:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],fr:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],ch:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],de:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],jp:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],pt:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],da:["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],pl:["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],es:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]},months:{en:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ko:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],fr:["Jan","Fév","Mar","Avr","Mai","Juin","Juil","Aoû","Sep","Oct","Nov","Déc"],ch:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],de:["Jän","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],jp:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],pt:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],da:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],pl:["Sty","Lut","Mar","Kwi","Maj","Cze","Lip","Sie","Wrz","Paź","Lis","Gru"],es:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dec"]}};a.fn[ComponentName]=function(h){var i={init:function(h){var i=this;this.settings=a.extend({lang:"en",theme:"light",date:moment(),format:"YYYY-MM-DD",enabledDates:[],disabledDates:[],disabledWeekdays:[],disabledRanges:[],schedules:[],scheduleOptions:{colors:{}},week:0,weeks:g.weeks.en,monthsLong:g.monthsLong.en,months:g.months.en,pickWeeks:!1,initialize:!0,multiple:!1,toggle:!1,reverse:!1,buttons:!1,modal:!1,minDate:null,maxDate:null,select:null,apply:null},h),"en"!==this.settings.lang&&a.inArray(this.settings.lang,g.supports)!==-1&&(this.settings.weeks=g.weeks[this.settings.lang],this.settings.monthsLong=g.monthsLong[this.settings.lang],this.settings.months=g.months[this.settings.lang]),"light"!==this.settings.theme&&a.inArray(this.settings.theme,ComponentPreference.supports.themes)===-1&&(this.settings.theme="light"),this.settings.pickWeeks===!0&&(this.settings.multiple===!1?console.error("You must give true at settings.multiple options on PIGNOSE-Calendar for using in pickWeeks option."):this.settings.toggle===!0&&console.error("You must give false at settings.toggle options on PIGNOSE-Calendar for using in pickWeeks option.")),this.settings.week%=this.settings.weeks.length,this.global={calendarHtml:Helper.Format('<div class="{0} {0}-{4}">\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{1}">\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="{1}-nav {1}-prev">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="icon-arrow-left {1}-icon"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{1}-date">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="{1}-month"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="{1}-year"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="{1}-nav {1}-next">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="icon-arrow-right {1}-icon"></span>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{2}"></div>\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="{3}"></div>\t\t\t\t\t\t\t\t\t\t\t\t</div>',ComponentClass,c,d,e,i.settings.theme),calendarButtonsHtml:Helper.Format('<div class="{0}-group">\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="{0} {0}-cancel">Cancel</a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="{0} {0}-apply">OK</a>\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>',f),calendarScheduleContainerHtml:Helper.Format('<div class="{0}-schedule-container"></div>',f),calendarSchedulePinHtml:Helper.Format('<span class="{0}-schedule-pin {0}-schedule-pin-\\{0\\}" style="background-color: \\{1\\};"></span>',f)};var j=Helper.GetSubClass("UnitRange"),k=Helper.GetSubClass("UnitRangeFirst"),l=Helper.GetSubClass("UnitRangeLast"),m=Helper.GetSubClass("UnitActive"),n=[Helper.GetSubClass("UnitFirstActive"),Helper.GetSubClass("UnitSecondActive")],o=Helper.GetSubClass("UnitToggleActive"),p=Helper.GetSubClass("UnitToggleInactive");return this.each(function(){var h=a(this),q=h,r=h,s={initialize:null,calendar:a(i.global.calendarHtml),input:h.is("input"),renderer:null,current:[null,null],storage:{activeDates:[],events:[]},dateManager:new DateManager(i.settings.date),calendarWrapperHtml:Helper.Format('<div class="{0}"></div>',Helper.GetSubClass("Wrapper")),calendarWrapperOverlayHtml:Helper.Format('<div class="{0}"></div>',Helper.GetSubClass("WrapperOverlay")),context:i};i.settings.initialize===!0&&(s.initialize=s.current[0]=s.dateManager.date.clone()),this.local=s,i.settings.reverse===!0?s.calendar.addClass(Helper.GetSubClass("Reverse")):s.calendar.addClass(Helper.GetSubClass("Default"));for(var t=i.settings.week;t<i.settings.weeks.length+i.settings.week;t++){var u=i.settings.weeks[t%i.settings.weeks.length];if("string"==typeof u){u=u.toUpperCase();a(Helper.Format('<div class="{0} {0}-{2}">{1}</div>',Helper.GetSubClass("Week"),u,g.weeks.en[t%g.weeks.en.length].toLowerCase())).appendTo(s.calendar.find("."+d))}}if(i.settings.buttons===!0){var v=a(i.global.calendarButtonsHtml);v.appendTo(s.calendar)}if(s.input===!0||i.settings.modal===!0){var w=Helper.GetSubClass("WrapperActive"),x=Helper.GetSubClass("WrapperOverlayActive"),y=a("."+Helper.GetSubClass("WrapperOverlay"));y.length<1&&(y=a(s.calendarWrapperOverlayHtml),y.appendTo("body").hide()),r=a(s.calendarWrapperHtml),r.appendTo("body"),r.bind("click",function(a){a.stopPropagation()}),h.bind("click",function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),setTimeout(function(){y.show(),r.show(),b.unbind("resize."+ComponentClass).bind("resize."+ComponentClass,function(){r.css({marginLeft:-r.outerWidth()/2,marginTop:-r.outerHeight()/2})}).triggerHandler("resize."+ComponentClass),q[ComponentName]("set",h.val()),setTimeout(function(){y.addClass(x),r.addClass(w)},25)},25)}).bind("focus",function(b){a(this).blur()}),y.bind("click."+ComponentClass,function(){r.trigger("cancel."+ComponentClass)}),r.unbind("cancel."+ComponentClass+" apply."+ComponentClass).bind("cancel."+ComponentClass+" apply."+ComponentClass,function(){y.removeClass(x).hide(),r.removeClass(w).hide()})}var z=function(){if(null===s.current[0]||null===s.current[1])return!1;var a=s.current[0].format("YYYY-MM-DD"),b=s.current[1].format("YYYY-MM-DD"),c=moment(Math.max(s.current[0].valueOf(),s.dateManager.date.clone().startOf("month").valueOf())),d=moment(Math.min(s.current[1].valueOf(),s.dateManager.date.clone().endOf("month").valueOf())),e=c.format("YYYY-MM-DD")!==a,f=d.format("YYYY-MM-DD")!==b;e===!1&&c.add(1,"days"),f===!1&&d.add(-1,"days");for(var g=c.format("YYYY-MM-DD"),h=d.format("YYYY-MM-DD");c.format("YYYY-MM-DD")<=d.format("YYYY-MM-DD");c.add(1,"days")){var i=c.format("YYYY-MM-DD"),m=s.calendar.find(Helper.Format('.{0}[data-date="{1}"]',Helper.GetSubClass("Unit"),i)).addClass(j);i===g&&m.addClass(k),i===h&&m.addClass(l)}};s.renderer=function(){s.calendar.appendTo(r.empty()),s.calendar.find("."+c+"-year").text(s.dateManager.year),s.calendar.find("."+c+"-month").text(i.settings.monthsLong[s.dateManager.month-1]),s.calendar.find(Helper.Format(".{0}-prev .{0}-value",c)).text(i.settings.months[s.dateManager.prevMonth-1].toUpperCase()),s.calendar.find(Helper.Format(".{0}-next .{0}-value",c)).text(i.settings.months[s.dateManager.nextMonth-1].toUpperCase()),i.settings.buttons===!0&&v.find("."+f).bind("click",function(b){if(b.preventDefault(),b.stopPropagation(),a(this).hasClass(f+"-apply")){q.trigger("apply."+ComponentName,s);var c="";if(i.settings.toggle===!0)c=s.storage.activeDates.join(", ");else if(i.settings.multiple===!0){var d=[];null!==s.current[0]&&d.push(s.current[0].format(i.settings.format)),null!==s.current[1]&&d.push(s.current[1].format(i.settings.format)),c=d.join(" ~ ")}else c=null===s.current[0]?"":moment(s.current[0]).format(i.settings.format);s.input===!0&&q.val(c).triggerHandler("change"),"function"==typeof i.settings.apply&&i.settings.apply.call(q,c),r.triggerHandler("apply."+ComponentClass)}else r.triggerHandler("cancel."+ComponentClass)});var b=s.calendar.find("."+e).empty(),d=DateManager.Convert(s.dateManager.year,s.dateManager.month,s.dateManager.firstDay),h=DateManager.Convert(s.dateManager.year,s.dateManager.month,s.dateManager.lastDay),t=d.weekday()-i.settings.week,u=h.weekday()-i.settings.week;t<0&&(t+=i.settings.weeks.length);for(var w=[],x=[null===s.current[0]?null:s.current[0].format("YYYY-MM-DD"),null===s.current[1]?null:s.current[1].format("YYYY-MM-DD")],y=null===i.settings.minDate?null:moment(i.settings.minDate),A=null===i.settings.maxDate?null:moment(i.settings.maxDate),B=0;B<t;B++){var C=a(Helper.Format('<div class="{0} {0}-{1}"></div>',Helper.GetSubClass("Unit"),g.weeks.en[B].toLowerCase()));w.push(C)}for(var B=s.dateManager.firstDay;B<=s.dateManager.lastDay;B++){var D=DateManager.Convert(s.dateManager.year,s.dateManager.month,B),E=D.format("YYYY-MM-DD"),C=a(Helper.Format('<div class="{0} {0}-date {0}-{3}" data-date="{1}"><a href="#">{2}</a></div>',Helper.GetSubClass("Unit"),D.format("YYYY-MM-DD"),B,g.weeks.en[D.weekday()].toLowerCase()));if(i.settings.enabledDates.length>0)a.inArray(E,i.settings.enabledDates)===-1&&C.addClass(Helper.GetSubClass("UnitDisabled"));else if(i.settings.disabledWeekdays.length>0&&a.inArray(D.weekday(),i.settings.disabledWeekdays)!==-1)C.addClass(Helper.GetSubClass("UnitDisabled")).addClass(Helper.GetSubClass("UnitDisabledWeekdays"));else if(null!==y&&y.diff(D)>0||null!==A&&A.diff(D)<0)C.addClass(Helper.GetSubClass("UnitDisabled")).addClass(Helper.GetSubClass("UnitDisabledRange"));else if(a.inArray(E,i.settings.disabledDates)!==-1)C.addClass(Helper.GetSubClass("UnitDisabled"));else if(i.settings.disabledRanges.length>0)for(var F=i.settings.disabledRanges.length,G=0;G<F;G++){var H=i.settings.disabledRanges[G];H.length;if(D.diff(moment(H[0]))>=0&&D.diff(moment(H[1]))<=0){C.addClass(Helper.GetSubClass("UnitDisabled")).addClass(Helper.GetSubClass("UnitDisabledRange")).addClass(Helper.GetSubClass("UnitDisabledMultipleRange"));break}}if(i.settings.schedules.length>0&&"object"==typeof i.settings.scheduleOptions&&"object"==typeof i.settings.scheduleOptions.colors){var I=i.settings.schedules.filter(function(a){return a.date===E}),J=a.unique(I.map(function(a,b){return a.name}).sort());if(J.length>0){var K=a(i.global.calendarScheduleContainerHtml);K.appendTo(C),J.map(function(b,c){if(void 0!==i.settings.scheduleOptions.colors[b]){var d=i.settings.scheduleOptions.colors[b];a(Helper.Format(i.global.calendarSchedulePinHtml,b,d)).appendTo(K)}})}}i.settings.toggle===!0?a.inArray(E,s.storage.activeDates)!==-1&&s.storage.activeDates.length>0?C.addClass(o):C.addClass(p):C.hasClass(Helper.GetSubClass("UnitDisabled"))===!1&&(i.settings.multiple===!0?(null!==x[0]&&E===x[0]&&C.addClass(m).addClass(n[0]),null!==x[1]&&E===x[1]&&C.addClass(m).addClass(n[1])):null!==x[0]&&E===x[0]&&a.inArray(x[0],i.settings.disabledDates)===-1&&(i.settings.enabledDates.length<1||a.inArray(x[0],i.settings.enabledDates)!==-1)&&C.addClass(m).addClass(n[0])),w.push(C),C.bind("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this),d=0,e=c.data("date");if(c.hasClass(Helper.GetSubClass("UnitDisabled")))return!1;if(s.input===!0&&i.settings.multiple===!1&&i.settings.buttons===!1)return q.val(moment(e).format(i.settings.format)),r.triggerHandler("apply."+ComponentClass),!1;if(null!==s.initialize&&s.initialize.format("YYYY-MM-DD")===e&&i.settings.toggle===!1);else{if(i.settings.toggle===!0){var f=s.storage.activeDates.filter(function(a,b){return a===e});if(s.current[d]=moment(e),f.length<1)s.storage.activeDates.push(e),c.addClass(o).removeClass(p);else{for(var g=0,h=0;h<s.storage.activeDates.length;h++){if(e===s.storage.activeDates[h]){g=h;break}}s.storage.activeDates.splice(g,1),c.removeClass(o).addClass(p)}}else if(c.hasClass(m)===!0&&i.settings.pickWeeks===!1)i.settings.multiple===!0&&(c.hasClass(n[0])?d=0:n[1]&&(d=1)),c.removeClass(m).removeClass(n[d]),s.current[d]=null;else{if(i.settings.pickWeeks===!0)if(c.hasClass(m)===!0||c.hasClass(j)===!0){for(var t=0;t<2;t++)s.calendar.find("."+m+"."+n[t]).removeClass(m).removeClass(n[t]);s.current[0]=null,s.current[1]=null}else{s.current[0]=moment(e).startOf("week"),s.current[1]=moment(e).endOf("week");for(var t=0;t<2;t++)s.calendar.find("."+m+"."+n[t]).removeClass(m).removeClass(n[t]),s.calendar.find(Helper.Format('.{0}[data-date="{1}"]',Helper.GetSubClass("Unit"),s.current[t].format("YYYY-MM-DD"))).addClass(m).addClass(n[t])}else i.settings.multiple===!0&&(null===s.current[0]?d=0:null===s.current[1]?d=1:(d=0,s.current[1]=null,s.calendar.find("."+m+"."+n[1]).removeClass(m).removeClass(n[1]))),s.calendar.find("."+m+"."+n[d]).removeClass(m).removeClass(n[d]),c.addClass(m).addClass(n[d]),s.current[d]=moment(e);if(i.settings.multiple===!0&&s.calendar.find("."+j).removeClass(j).removeClass(k).removeClass(l),null!==s.current[0]&&null!==s.current[1]){if(s.current[0].diff(s.current[1])>0){var u=s.current[0];s.current[0]=s.current[1],s.current[1]=u,u=null,s.calendar.find("."+m).each(function(){var b=a(this);for(var c in n){var d=n[c];b.toggleClass(d)}})}if(s.input===!0&&i.settings.buttons===!1){var v=[];null!==s.current[0]&&v.push(s.current[0].format(i.settings.format)),null!==s.current[1]&&v.push(s.current[1].format(i.settings.format)),q.val(v.join(", ")),r.trigger("apply."+ComponentClass)}z.call()}}i.settings.schedules.length>0&&(s.storage.schedules=i.settings.schedules.filter(function(a){return a.date===e}))}s.initialize=null,"function"==typeof i.settings.select&&i.settings.select.call(c,s.current,s)})}for(var B=u+1;w.length<5*i.settings.weeks.length;B++){var C=a(Helper.Format('<div class="{0} {0}-{1}"></div>',Helper.GetSubClass("Unit"),g.weeks.en[B%g.weeks.en.length].toLowerCase()));w.push(C)}for(var L=null,M=w.length,B=0;B<M;B++){var N=w[B];(B%i.settings.weeks.length==0||B+1>=M)&&(null!==L&&L.appendTo(b),B+1<M&&(L=a(Helper.Format('<div class="{0}"></div>',Helper.GetSubClass("Row"))))),L.append(N)}s.calendar.find("."+c+"-nav").bind("click",function(b){b.preventDefault(),b.stopPropagation();var d=a(this);d.hasClass(c+"-prev")?(s.dateManager=new DateManager(s.dateManager.date.clone().add(-1,"months")),s.renderer.call()):d.hasClass(c+"-next")&&(s.dateManager=new DateManager(s.dateManager.date.clone().add(1,"months")),s.renderer.call())}),i.settings.multiple===!0&&(s.calendar.find("."+j).removeClass(j).removeClass(k).removeClass(l),z.call())},s.renderer.call(),h[0][ComponentName]=s})},set:function(b){if(void 0!==b&&null!==b&&""!==b){var c=b.split("~").map(function(b){var c=a.trim(b);return"null"===c||""===c?null:c});this.each(function(){var b=a(this),d=b[0][ComponentName],e=d.context,f=[void 0===c[0]||null===c[0]?null:moment(c[0],e.settings.format),void 0===c[1]||null===c[1]?null:moment(c[1],e.settings.format)];if(d.dateManager=new DateManager(f[0]),e.settings.pickWeeks===!0&&null!==f[0]){var g=f[0];f[0]=g.clone().startOf("week"),f[1]=g.clone().endOf("week")}e.settings.toggle===!0?d.storage.activeDates=c:d.current=f,d.renderer.call()})}},select:function(b){this.each(function(){var c=this.local,d=c.dateManager,e=Helper.Format("{0}-{1}-{2}",d.year,d.month,b);a(this).find(Helper.Format('.{0}[data-date="{1}"]',Helper.GetSubClass("Unit"),e)).triggerHandler("click")})}};return i[h]?i[h].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof h&&h?void console.error("Argument error are occured."):i.init.apply(this,arguments)}}(jQuery);